<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Cosmic Receipt</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="apple-mobile-web-app-status-bar-style" content="white">
  <meta name="theme-color" content="#ffffff">

  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600;700&family=Courier+Prime&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #f3e5f5;
      --accent: #ab47bc;
      --text: #4a148c;
      --paper: #fff;
      --radius: 20px;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: "Quicksand", sans-serif;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.5s ease;
      padding: 20px;
      box-sizing: border-box;
    }

    .controls {
      width: 100%;
      max-width: 360px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .name-box {
      background: rgba(255,255,255,0.9);
      border: 2px solid var(--accent);
      padding: 16px;
      border-radius: 25px;
      font-family: "Quicksand", sans-serif;
      font-weight: 700;
      font-size: 1.1rem;
      text-align: center;
      color: var(--text);
      outline: none;
      box-shadow: 0 5px 20px rgba(0,0,0,0.05);
    }

    .sign-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .sign-btn {
      background: rgba(255,255,255,0.8);
      border: 2px solid var(--accent);
      color: var(--accent);
      padding: 15px 5px;
      border-radius: 18px;
      font-weight: 700;
      font-size: 0.8rem;
      cursor: pointer;
      transition: transform 0.1s;
      text-transform: uppercase;
    }

    .sign-btn:active {
      transform: scale(0.95);
      background: var(--accent);
      color: #fff;
    }

    /* RECEIPT LAYOUT */
    .receipt-container {
      perspective: 1000px;
      width: 100%;
      max-width: 340px;
      display: none;
    }

    .receipt {
      background: var(--paper);
      padding: 30px 25px;
      font-family: "Courier Prime", monospace;
      color: var(--text);
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      animation: printReceipt 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
      position: relative;
      text-align: center;
      --mask: radial-gradient(10px at 50% 100%, #0000 98%, #000 100%) 50% calc(100% - 10px)/20px 100% repeat-x;
      -webkit-mask: var(--mask); 
      mask: var(--mask);
      padding-bottom: 60px;
    }

    @keyframes printReceipt {
      0% { height: 0; opacity: 0; transform: translateY(-50px); }
      100% { height: auto; opacity: 1; transform: translateY(0); }
    }

    .ascii-art {
      white-space: pre;
      font-size: 0.8rem;
      line-height: 1;
      margin-bottom: 10px;
      opacity: 0.8;
      font-weight: bold;
    }

    .header-bubble {
      display: inline-block;
      border: 2px solid var(--accent);
      border-radius: 50px;
      padding: 8px 25px;
      margin-bottom: 5px;
    }
    .header-bubble h2 {
      margin: 0;
      font-size: 1.4rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .est-text { font-size: 0.75rem; margin-bottom: 20px; opacity: 0.7; }

    .info-bubble {
      border: 2px solid var(--accent);
      border-radius: 22px;
      padding: 15px;
      margin-bottom: 25px;
      font-size: 0.85rem;
      line-height: 1.6;
      text-align: center;
      background: rgba(255,255,255,0.1);
    }

    .item-list { text-align: left; margin-bottom: 20px; padding: 0 5px; }
    
    .item { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; }
    .checklist-item { margin-bottom: 12px; font-size: 1rem; text-align: left; display: flex; align-items: center; gap: 10px;}
    
    .divider { border-top: 2px dashed var(--accent); margin: 20px 0; opacity: 0.5; }

    .total { display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem; color: var(--accent); }
    
    /* NEW SECTIONS */
    .forecast-box {
      margin-top: 25px;
      font-size: 0.75rem;
      opacity: 0.9;
      border: 1px solid var(--accent);
      padding: 8px;
      display: inline-block;
      width: 90%;
    }

    .coupon {
      margin-top: 25px;
      border: 2px dashed var(--accent);
      padding: 15px;
      font-weight: bold;
      font-size: 0.9rem;
      background: rgba(255,255,255,0.2);
      transform: rotate(-1deg);
    }
    
    .barcode { margin-top: 20px; font-size: 2rem; opacity: 0.4; letter-spacing: -3px; transform: scaleY(0.7); }

    .trophy-bar {
      margin-top: 20px;
      background: rgba(255,255,255,0.4);
      padding: 12px;
      border-radius: 99px;
      color: var(--text);
      font-weight: 700;
      font-size: 0.85rem;
      backdrop-filter: blur(5px);
      text-align: center;
      border: 1px solid rgba(255,255,255,0.5);
    }
    
    /* GOLDEN TICKET ANIMATION */
    @keyframes shine {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
  </style>
</head>
<body>

  <div class="controls" id="controls">
    <input type="text" id="nameInput" class="name-box" placeholder="Your Name (or Secret Code)">
    <div class="sign-grid" id="signGrid"></div>
    <div class="trophy-bar" id="tierDisplay">MEMBER: LOADING...</div>
  </div>

  <div class="receipt-container" id="receiptContainer">
    <div class="receipt">
      <div class="ascii-art" id="asciiDisplay"></div>
      
      <div class="header-bubble">
        <h2 id="storeName">LOADING...</h2>
      </div>
      <div class="est-text" id="estText">est. 2026 â€¢ digital receipt</div>

      <div class="info-bubble" id="infoBubble"></div>

      <div class="item-list" id="itemList"></div>

      <div class="divider"></div>

      <div class="total">
        <span id="totalLabel">TOTAL:</span>
        <span id="totalText">$0.00</span>
      </div>

      <div id="bottomSection">
        </div>
      
      <div style="font-size:0.7rem; margin-top:20px; opacity:0.6;">THANK YOU FOR SHOPPING</div>
    </div>
    <div style="text-align:center; color: var(--text); font-size:0.8rem; margin-top:20px; opacity:0.6; cursor: pointer;">
      ( tap to reset )
    </div>
  </div>

  <script>
    const shopNames = ["THE MALL", "GIRL WORLD", "PLASTIC DREAMS", "ARCHIVE", "ANGEL DEPT", "VELVET ROPE", "LIMITED ED.", "SOLDOUT", "MAIN CHAR."];
    
    // --- ASCII ART COLLECTION ---
    const arts = {
      default: "â™¥",
      nature: "    /\\\n   /  \\\n  /____\\ \n    ||", // Simple tree
      ocean: ".~ .~~~ ..~",
      stars: "âœ¨  âœ¦  âœ¨",
      bow: "  /\\ /\\\n  ( o.o )\n   > ^ <",
      cyber: "[ o_o ]"
    };

    // --- MOODS ---
    const moods = {
      rotting: { color: "#78909c", bg: "#eceff1", scent: "BEDSHEETS", art: arts.default, items: ["Doomscrolling", "Dirty Hair", "Uber Eats"] },
      thriving: { color: "#43a047", bg: "#e8f5e9", scent: "MATCHA", art: "ðŸŒ¿", items: ["Green Juice", "Yoga Mat", "Skin Glow"] },
      manic: { color: "#ff9100", bg: "#fff3e0", scent: "RED BULL", art: "âš¡", items: ["Impulse Buy", "Fast Talking", "God Complex"] },
      numb: { color: "#bdbdbd", bg: "#fafafa", scent: "STATIC", art: "...", items: ["Staring at Wall", "Nothing", "White Noise"] },
      delusional: { color: "#f06292", bg: "#fce4ec", scent: "FROSTING", art: arts.bow, items: ["Fake Scenario", "He Loves Me", "Fantasy"] },
      yearning: { color: "#7e57c2", bg: "#ede7f6", scent: "RAIN", art: "â˜ï¸", items: ["Poetry", "Old Photos", "Sad Music"] },
      hating: { color: "#d32f2f", bg: "#ffebee", scent: "SMOKE", art: "âœ–", items: ["Blocking Him", "Side Eye", "Judgment"] },
      healing: { color: "#8d6e63", bg: "#efebe9", scent: "SAGE", art: "ðŸ•¯ï¸", items: ["Therapy", "Journaling", "Boundaries"] },
      spiraling: { color: "#304ffe", bg: "#e8eaf6", scent: "WINE", art: "ðŸŒ€", items: ["Overthinking", "Panic", "Regret"] },
      lurking: { color: "#2e7d32", bg: "#e8f5e9", scent: "SCREEN", art: "ðŸ‘ï¸", items: ["Screenshots", "Private Tab", "Research"] },
      posting: { color: "#00b0ff", bg: "#e1f5fe", scent: "HAIRSPRAY", art: "ðŸ“¸", items: ["Drafts", "Clout", "Validation"] },
      productive: { color: "#fdd835", bg: "#fffde7", scent: "PAPER", art: "ðŸ“", items: ["Emails", "Iced Coffee", "To-Do List"] }
    };

    // --- SECRETS (Updated Matt) ---
    const secrets = {
      "lottie": { color: "#00ffff", bg: "#001e3c", paper: "#002845", store: "ATLANTIS", art: arts.ocean, item: "Pearl" },
      "matt": { 
        color: "#2e4e34", bg: "#1b3323", paper: "#d7ccc8", // Recycled Paper Look
        store: "SEQUOIA", art: arts.nature, item: "Mossy Log", scent: "PINE" 
      },
      "doll": { color: "#880e4f", bg: "#212121", paper: "#ffebee", store: "MORUTE", art: arts.bow, item: "Porcelain" },
      "cyber": { color: "#00e676", bg: "#000000", paper: "#1a1a1a", store: "SYSTEM_32", art: arts.cyber, item: "Data" },
      "angel": { color: "#ffd700", bg: "#fffde7", paper: "#ffffff", store: "HEAVEN", art: arts.stars, item: "Halo" }
    };

    const commonItems = [{name: "Iced Coffee", price: 7.50}, {name: "Sweet Treat", price: 5.00}, {name: "Lip Gloss", price: 12.00}, {name: "Girl Dinner", price: 8.00}];
    
    // --- FORTUNES & COUPONS ---
    const fortunes = ["LUCKY NUMBER: 444", "AURA: PINK", "MANIFESTING: $$$", "VIBE: IMMACULATE", "AVOID: EXES", "ENERGY: PROTECTED"];
    const coupons = ["VALID FOR: 1 NAP", "VOUCHER: 1 FREE CRY", "ADMIT ONE: TO THE DRAMA", "COUPON: TREAT YOURSELF", "PASS: SKIP SCHOOL/WORK"];

    // --- STATS ---
    let lifetimeSpend = parseFloat(localStorage.getItem('loyaltySpend') || 0);
    let totalReceipts = parseInt(localStorage.getItem('loyaltyCount') || 0);
    let moodCounts = JSON.parse(localStorage.getItem('loyaltyMoods') || '{}');

    function getTier(spend) {
      if (spend < 500) return "WINDOW SHOPPER";
      if (spend < 1500) return "MALL RAT";
      if (spend < 5000) return "VIP";
      if (spend < 10000) return "INFLUENCER";
      return "THE 1%";
    }

    function getTopMoods() {
      const sorted = Object.entries(moodCounts).sort((a, b) => b[1] - a[1]);
      const top3 = sorted.slice(0, 3).map(entry => entry[0].toUpperCase());
      return top3.length > 0 ? top3.join(", ") : "UNKNOWN";
    }

    function updateDisplay() {
      const tier = getTier(lifetimeSpend);
      document.getElementById('tierDisplay').innerText = `MEMBER: ${tier} ($${Math.floor(lifetimeSpend)})`;
    }

    // --- INIT ---
    const grid = document.getElementById('signGrid');
    Object.keys(moods).forEach(key => {
      const btn = document.createElement('button');
      btn.className = 'sign-btn';
      btn.innerText = key;
      btn.onclick = () => generate(key);
      grid.appendChild(btn);
    });
    updateDisplay();

    // --- GENERATE ---
    function generate(moodKey) {
      const nameRaw = document.getElementById('nameInput').value.trim().toLowerCase();
      const nameDisplay = document.getElementById('nameInput').value || "Guest";
      
      let theme = moods[moodKey];
      let storeName = shopNames[Math.floor(Math.random() * shopNames.length)];
      let paperColor = "#ffffff";
      let bonusItem = null;
      let ascii = theme.art || arts.default;

      // Check Secret
      if (secrets[nameRaw]) {
        const s = secrets[nameRaw];
        theme = { color: s.color, bg: s.bg };
        storeName = s.store;
        paperColor = s.paper;
        ascii = s.art || arts.stars;
        bonusItem = { name: s.item, price: 999.00 };
      }

      // GOLDEN TICKET CHECK (2% Chance)
      const isGold = Math.random() < 0.02;
      if (isGold) {
        theme = { color: "#d50000", bg: "#fff8e1" }; // Gold/Red vibe
        paperColor = "linear-gradient(135deg, #fffde7, #ffd700)";
        storeName = "JACKPOT";
        ascii = "ðŸ’° ðŸ’° ðŸ’°";
        document.documentElement.style.setProperty('--text', '#bf360c');
      } else {
        document.documentElement.style.setProperty('--text', theme.color);
      }

      // Apply Visuals
      document.documentElement.style.setProperty('--bg', theme.bg);
      document.documentElement.style.setProperty('--accent', theme.color);
      document.documentElement.style.setProperty('--paper', paperColor);
      
      // Update Stats
      moodCounts[moodKey] = (moodCounts[moodKey] || 0) + 1;
      localStorage.setItem('loyaltyMoods', JSON.stringify(moodCounts));
      totalReceipts++;
      localStorage.setItem('loyaltyCount', totalReceipts);

      // --- BUILD RECEIPT ---
      document.getElementById('storeName').innerText = storeName;
      document.getElementById('asciiDisplay').innerText = ascii;

      let currentTotal = 0;
      let pool = [...commonItems];
      moods[moodKey].items.forEach(i => pool.push({name: i, price: 20.00}));
      const count = Math.floor(Math.random() * 3) + 3;
      const shuffled = pool.sort(() => 0.5 - Math.random());
      const selected = shuffled.slice(0, count);
      if (bonusItem) selected.unshift(bonusItem);

      let html = '';
      selected.forEach(i => {
        currentTotal += i.price;
        html += `<div class="item"><span>1x ${i.name}</span><span>$${i.price.toFixed(2)}</span></div>`;
      });
      document.getElementById('itemList').innerHTML = html;
      
      // Handle Gold Total
      if (isGold) {
        currentTotal = -1000.00; // Refund!
        document.getElementById('totalText').innerText = "-$1,000.00";
      } else {
        document.getElementById('totalText').innerText = `$${currentTotal.toFixed(2)}`;
      }

      lifetimeSpend += currentTotal;
      localStorage.setItem('loyaltySpend', lifetimeSpend);
      
      const currentTier = isGold ? "THE CHOSEN ONE" : getTier(lifetimeSpend);
      document.getElementById('infoBubble').innerHTML = `
        CUSTOMER: ${nameDisplay.toUpperCase()}<br>
        MEMBER: ${currentTier}<br>
        MOOD: ${moodKey.toUpperCase()} #${moodCounts[moodKey]}
      `;

      // --- BOTTOM SECTION LOGIC (Forecast or Coupon or Barcode) ---
      const bottomDiv = document.getElementById('bottomSection');
      const rand = Math.random();
      
      if (rand < 0.3) {
        // 30% Chance: COUPON
        const coup = coupons[Math.floor(Math.random() * coupons.length)];
        bottomDiv.innerHTML = `<div class="coupon">âœ‚ --- ${coup} --- âœ‚</div>`;
      } else {
        // 70% Chance: FORECAST + BARCODE
        const fort = fortunes[Math.floor(Math.random() * fortunes.length)];
        const topMoods = getTopMoods();
        bottomDiv.innerHTML = `
           <div class="forecast-box">
             <div>${fort}</div>
             <div style="margin-top:5px; font-size:0.65rem;">MOOD BOARD: ${topMoods}</div>
           </div>
           <div class="barcode">|| | ||| || |||</div>
        `;
      }

      document.getElementById('controls').style.display = 'none';
      document.getElementById('receiptContainer').style.display = 'block';
    }

    document.addEventListener('click', (e) => {
      const container = document.getElementById('receiptContainer');
      if (container.style.display === 'block' && (e.target.closest('.receipt-container') || e.target.closest('.receipt'))) {
        document.getElementById('controls').style.display = 'flex';
        container.style.display = 'none';
        document.getElementById('nameInput').value = ""; 
        updateDisplay(); 
      }
    });

    if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
  </script>
</body>
</html>
