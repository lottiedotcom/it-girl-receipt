<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Cosmic Loyalty</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="apple-mobile-web-app-status-bar-style" content="white">
  <meta name="theme-color" content="#ffffff">

  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600;700&family=Courier+Prime&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #f3e5f5;
      --accent: #ab47bc;
      --text: #4a148c;
      --paper: #fff;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: "Quicksand", sans-serif;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.5s ease;
      padding: 20px;
      box-sizing: border-box;
    }

    .controls {
      width: 100%;
      max-width: 360px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .name-box {
      background: rgba(255,255,255,0.9);
      border: 2px solid var(--accent);
      padding: 16px;
      border-radius: 25px;
      font-family: "Quicksand", sans-serif;
      font-weight: 700;
      font-size: 1.1rem;
      text-align: center;
      color: var(--text);
      outline: none;
      box-shadow: 0 5px 20px rgba(0,0,0,0.05);
    }

    .sign-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .sign-btn {
      background: rgba(255,255,255,0.8);
      border: 2px solid var(--accent);
      color: var(--accent);
      padding: 15px 5px;
      border-radius: 18px;
      font-weight: 700;
      font-size: 0.8rem;
      cursor: pointer;
      transition: transform 0.1s;
      text-transform: uppercase;
    }
    .sign-btn:active { transform: scale(0.95); background: var(--accent); color: #fff; }

    /* RECEIPT LAYOUT */
    .receipt-container {
      perspective: 1000px;
      width: 100%;
      max-width: 340px;
      display: none;
    }

    .receipt {
      background: var(--paper);
      padding: 30px 25px;
      font-family: "Courier Prime", monospace;
      color: var(--text);
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      animation: printReceipt 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
      position: relative;
      text-align: center;
      --mask: radial-gradient(10px at 50% 100%, #0000 98%, #000 100%) 50% calc(100% - 10px)/20px 100% repeat-x;
      -webkit-mask: var(--mask); 
      mask: var(--mask);
      padding-bottom: 60px;
    }

    @keyframes printReceipt {
      0% { height: 0; opacity: 0; transform: translateY(-50px); }
      100% { height: auto; opacity: 1; transform: translateY(0); }
    }

    /* HEADER ELEMENTS */
    .ascii-art {
      white-space: pre;
      font-size: 0.8rem;
      line-height: 1;
      margin-bottom: 10px;
      opacity: 0.8;
      font-weight: bold;
    }

    .header-bubble {
      display: inline-block;
      border: 2px solid var(--accent);
      border-radius: 50px;
      padding: 8px 25px;
      margin-bottom: 5px;
    }
    .header-bubble h2 {
      margin: 0;
      font-size: 1.4rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .est-text { font-size: 0.75rem; margin-bottom: 20px; opacity: 0.7; }

    .info-bubble {
      border: 2px solid var(--accent);
      border-radius: 22px;
      padding: 15px;
      margin-bottom: 20px;
      font-size: 0.85rem;
      line-height: 1.6;
      text-align: center;
      background: rgba(255,255,255,0.1);
    }

    /* ITEMS */
    .item-list { text-align: left; margin-bottom: 20px; padding: 0 5px; }
    .item { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; }
    .checklist-item { margin-bottom: 12px; font-size: 1rem; text-align: left; display: flex; align-items: center; gap: 10px;}
    
    .divider { border-top: 2px dashed var(--accent); margin: 20px 0; opacity: 0.5; }
    .total { display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem; color: var(--accent); }
    
    /* LOYALTY CARD SECTION */
    .loyalty-section {
      margin-top: 25px;
      border: 1px solid var(--accent);
      border-radius: 15px;
      padding: 12px;
      font-size: 0.8rem;
      background: rgba(255,255,255,0.3);
    }
    
    .stamps {
      font-size: 1.5rem;
      letter-spacing: 5px;
      margin-top: 5px;
    }

    /* EXTRAS */
    .bottom-extras { margin-top: 25px; }
    .coupon {
      border: 2px dashed var(--accent);
      padding: 10px;
      font-weight: bold;
      font-size: 0.85rem;
      transform: rotate(-1deg);
    }
    .forecast { font-size: 0.7rem; opacity: 0.8; margin-bottom: 5px; }
    .barcode { margin-top: 15px; font-size: 2rem; opacity: 0.4; letter-spacing: -3px; transform: scaleY(0.7); }

    .trophy-bar {
      margin-top: 20px;
      background: rgba(255,255,255,0.4);
      padding: 12px;
      border-radius: 99px;
      color: var(--text);
      font-weight: 700;
      font-size: 0.85rem;
      backdrop-filter: blur(5px);
      text-align: center;
      border: 1px solid rgba(255,255,255,0.5);
    }
  </style>
</head>
<body>

  <div class="controls" id="controls">
    <input type="text" id="nameInput" class="name-box" placeholder="Your Name (or Secret Code)">
    <div class="sign-grid" id="signGrid"></div>
    <div class="trophy-bar" id="tierDisplay">LOADING...</div>
  </div>

  <div class="receipt-container" id="receiptContainer">
    <div class="receipt">
      
      <div class="ascii-art" id="asciiDisplay"></div>
      
      <div class="header-bubble">
        <h2 id="storeName">LOADING...</h2>
      </div>
      <div class="est-text" id="estText">est. 2026 ‚Ä¢ loyalty receipt</div>

      <div class="info-bubble" id="infoBubble"></div>

      <div class="item-list" id="itemList"></div>
      <div class="divider"></div>
      <div class="total">
        <span id="totalLabel">TOTAL:</span>
        <span id="totalText">$0.00</span>
      </div>

      <div class="loyalty-section" id="loyaltySection">
        <div style="font-weight:bold; font-size:0.75rem;" id="scentDisplay">SCENT: UNKNOWN</div>
        <div style="border-top:1px dashed var(--accent); opacity:0.3; margin:8px 0;"></div>
        <div>REWARD CARD:</div>
        <div class="stamps" id="stampsDisplay">‚ô°‚ô°‚ô°‚ô°‚ô°</div>
      </div>

      <div class="bottom-extras" id="bottomExtras"></div>
      
      <div style="font-size:0.7rem; margin-top:20px; opacity:0.6;">THANK YOU FOR SHOPPING</div>
    </div>
    <div style="text-align:center; color: var(--text); font-size:0.8rem; margin-top:20px; opacity:0.6; cursor: pointer;">
      ( tap to reset )
    </div>
  </div>

  <script>
    const shopNames = ["THE MALL", "GIRL WORLD", "PLASTIC DREAMS", "ARCHIVE", "ANGEL DEPT", "VELVET ROPE", "LIMITED ED.", "SOLDOUT", "MAIN CHAR."];
    
    // --- RANDOM MEMBER TITLES ---
    const memberTitles = [
      "PASSENGER PRINCESS", "FORMER GIFTED KID", "LOCAL CRYPTID", "IPAD ADULT", 
      "PROFESSIONAL NAPPER", "CAFFEINE DEPENDENT", "SILLY GOOSE", "ACADEMIC WEAPON",
      "CHRONICALLY ONLINE", "THEATRE KID", "HORSE GIRL", "SPACE CADET",
      "VINTED SELLER", "FANFICTION AUTHOR", "PLAYLIST CURATOR", "CAT MOM",
      "PLANT KILLER", "MALL RAT", "DEPARTMENT STORE GHOST", "PROFESSIONAL YEARNER",
      "CERTIFIED PRINCESS", "EMOTIONAL SUPPORT HUMAN", "DISCORD MOD", "REPLY GUY",
      "PINTEREST BOARD", "TUMBLR FAMOUS", "SLEEPY SOLDIER", "DRAMA QUEEN",
      "MAIN CHARACTER", "NPC", "SIDE CHARACTER", "VILLAIN ERA", "TIKTOK ADDICT",
      "SCREEN TIME VICTIM", "GIRL BLOGGER", "DIGITAL HOARDER", "STARGIRL",
      "CYBER ANGEL", "FOREST FAIRY", "DUNGEON MASTER", "GLITTER ENTHUSIAST",
      "BURNOUT VICTIM", "PROCRASTINATOR", "NIGHT OWL", "MORNING HATER",
      "WINDOW SHOPPER", "VIP", "INFLUENCER", "THE CHOSEN ONE"
    ];

    // --- ASCII ART ---
    const arts = {
      default: "‚ô•",
      nature: "    /\\\n   /  \\\n  /____\\ \n    ||", 
      ocean: ".~ .~~~ ..~",
      stars: "‚ú®  ‚ú¶  ‚ú®",
      bow: "  /\\ /\\\n  ( o.o )\n   > ^ <",
      cyber: "[ o_o ]"
    };

    // --- MOODS ---
    const moods = {
      rotting: { color: "#78909c", bg: "#eceff1", scent: "BEDSHEETS", art: arts.default, items: ["Doomscrolling", "Dirty Hair", "Uber Eats"] },
      thriving: { color: "#43a047", bg: "#e8f5e9", scent: "MATCHA", art: "üåø", items: ["Green Juice", "Yoga Mat", "Skin Glow"] },
      manic: { color: "#ff9100", bg: "#fff3e0", scent: "RED BULL", art: "‚ö°", items: ["Impulse Buy", "Fast Talking", "God Complex"] },
      numb: { color: "#bdbdbd", bg: "#fafafa", scent: "STATIC", art: "...", items: ["Staring at Wall", "Nothing", "White Noise"] },
      delusional: { color: "#f06292", bg: "#fce4ec", scent: "FROSTING", art: arts.bow, items: ["Fake Scenario", "He Loves Me", "Fantasy"] },
      yearning: { color: "#7e57c2", bg: "#ede7f6", scent: "RAIN", art: "‚òÅÔ∏è", items: ["Poetry", "Old Photos", "Sad Music"] },
      hating: { color: "#d32f2f", bg: "#ffebee", scent: "SMOKE", art: "‚úñ", items: ["Blocking Him", "Side Eye", "Judgment"] },
      healing: { color: "#8d6e63", bg: "#efebe9", scent: "SAGE", art: "üïØÔ∏è", items: ["Therapy", "Journaling", "Boundaries"] },
      spiraling: { color: "#304ffe", bg: "#e8eaf6", scent: "WINE", art: "üåÄ", items: ["Overthinking", "Panic", "Regret"] },
      lurking: { color: "#2e7d32", bg: "#e8f5e9", scent: "SCREEN", art: "üëÅÔ∏è", items: ["Screenshots", "Private Tab", "Research"] },
      posting: { color: "#00b0ff", bg: "#e1f5fe", scent: "HAIRSPRAY", art: "üì∏", items: ["Drafts", "Clout", "Validation"] },
      productive: { color: "#fdd835", bg: "#fffde7", scent: "PAPER", art: "üìù", items: ["Emails", "Iced Coffee", "To-Do List"] }
    };

    // --- SECRETS ---
    const secrets = {
      "lottie": { color: "#00ffff", bg: "#001e3c", paper: "#002845", store: "ATLANTIS", art: arts.ocean, item: "Pearl", scent: "DEEP SEA" },
      "matt": { color: "#2e4e34", bg: "#1b3323", paper: "#d7ccc8", store: "SEQUOIA", art: arts.nature, item: "Mossy Log", scent: "PINE" },
      "doll": { color: "#880e4f", bg: "#212121", paper: "#ffebee", store: "MORUTE", art: arts.bow, item: "Porcelain", scent: "LACE" },
      "cyber": { color: "#00e676", bg: "#000000", paper: "#1a1a1a", store: "SYSTEM_32", art: arts.cyber, item: "Data", scent: "OZONE" },
      "angel": { color: "#ffd700", bg: "#fffde7", paper: "#ffffff", store: "HEAVEN", art: arts.stars, item: "Halo", scent: "VANILLA" }
    };

    // --- THE BIG LIST OF ITEMS (UPDATED) ---
    const commonItems = [
      {name: "Iced Oat Latte", price: 8.50},
      {name: "Sonny Angel", price: 12.00},
      {name: "Claw Clip", price: 5.00},
      {name: "Satin Ribbon", price: 2.50},
      {name: "Platform Shoes", price: 120.00},
      {name: "Blind Box", price: 15.00},
      {name: "Digicam", price: 250.00},
      {name: "Phone Charm", price: 10.00},
      {name: "Unread Book", price: 18.00},
      {name: "Thrift Find", price: 25.00},
      {name: "Delivery Fee", price: 5.99},
      {name: "Strawberry Milk", price: 3.50},
      {name: "Tote Bag", price: 20.00},
      {name: "Face Mask", price: 4.00},
      {name: "Concert Tickets", price: 300.00},
      {name: "New Piercing", price: 60.00},
      {name: "Vending Machine", price: 2.00},
      {name: "Oat Milk Tax", price: 1.00},
      {name: "Lip Gloss", price: 12.00},
      {name: "Girl Dinner", price: 8.00},
      {name: "Therapy", price: 150.00},
      {name: "Little Walk", price: 0.00},
      {name: "Sweet Treat", price: 5.00},
      {name: "Spotify Premium", price: 11.99}
    ];

    const selfCareTasks = ["Drink water", "Face mask", "Phone DND 1hr", "Stretch", "Clean a corner", "Listen to music", "Go outside", "Unclench jaw"];
    const fortunes = ["LUCKY NUMBER: 444", "AURA: PINK", "MANIFESTING: $$$", "VIBE: IMMACULATE", "AVOID: EXES"];
    const coupons = ["VALID FOR: 1 NAP", "VOUCHER: 1 FREE CRY", "ADMIT ONE: TO THE DRAMA", "COUPON: TREAT YOURSELF"];

    // --- STATS ---
    let lifetimeSpend = parseFloat(localStorage.getItem('loyaltySpend') || 0);
    let totalReceipts = parseInt(localStorage.getItem('loyaltyCount') || 0);
    let moodCounts = JSON.parse(localStorage.getItem('loyaltyMoods') || '{}');
    
    function getSignatureScent() {
      let topMood = "numb";
      let maxCount = 0;
      for (const [mood, count] of Object.entries(moodCounts)) {
        if (count > maxCount) { maxCount = count; topMood = mood; }
      }
      return moods[topMood] ? moods[topMood].scent : "UNKNOWN";
    }

    function updateDisplay() {
      document.getElementById('tierDisplay').innerText = `TOTAL SPENT: $${Math.floor(lifetimeSpend)}`;
    }

    // --- INIT ---
    const grid = document.getElementById('signGrid');
    Object.keys(moods).forEach(key => {
      const btn = document.createElement('button');
      btn.className = 'sign-btn';
      btn.innerText = key;
      btn.onclick = () => generate(key);
      grid.appendChild(btn);
    });
    updateDisplay();

    // --- GENERATE ---
    function generate(moodKey) {
      const nameRaw = document.getElementById('nameInput').value.trim().toLowerCase();
      const nameDisplay = document.getElementById('nameInput').value || "Guest";
      
      let theme = moods[moodKey];
      let storeName = shopNames[Math.floor(Math.random() * shopNames.length)];
      let paperColor = "#ffffff";
      let bonusItem = null;
      let ascii = theme.art || arts.default;
      let scentOverride = null;

      if (secrets[nameRaw]) {
        const s = secrets[nameRaw];
        theme = { color: s.color, bg: s.bg };
        storeName = s.store;
        paperColor = s.paper;
        ascii = s.art || arts.stars;
        scentOverride = s.scent;
        bonusItem = { name: s.item, price: 999.00 };
      }

      // Visuals
      document.documentElement.style.setProperty('--bg', theme.bg);
      document.documentElement.style.setProperty('--accent', theme.color);
      document.documentElement.style.setProperty('--text', theme.color);
      document.documentElement.style.setProperty('--paper', paperColor);
      
      // Update Stats
      moodCounts[moodKey] = (moodCounts[moodKey] || 0) + 1;
      localStorage.setItem('loyaltyMoods', JSON.stringify(moodCounts));
      totalReceipts++;
      localStorage.setItem('loyaltyCount', totalReceipts);

      // --- 1. REWARD CHECK (Every 5th) ---
      const isReward = (totalReceipts % 5 === 0);
      
      if (isReward) {
        // REWARD MODE
        document.getElementById('storeName').innerText = "SELF CARE";
        document.getElementById('estText').innerText = "reward menu ‚Ä¢ you earned this";
        document.getElementById('asciiDisplay').innerText = "‚ô°";
        document.getElementById('infoBubble').innerHTML = `CUSTOMER: ${nameDisplay.toUpperCase()}<br>STATUS: <b>REWARD UNLOCKED</b>`;
        
        const tasks = selfCareTasks.sort(() => 0.5 - Math.random()).slice(0, 5);
        let html = '';
        tasks.forEach(t => html += `<div class="checklist-item">‚òê ${t}</div>`);
        document.getElementById('itemList').innerHTML = html;
        
        document.getElementById('totalLabel').innerText = "COST:";
        document.getElementById('totalText').innerText = "PRICELESS";
        document.getElementById('loyaltySection').style.display = 'none';
        document.getElementById('bottomExtras').innerHTML = `<div class="forecast">ENJOY YOUR BREAK</div>`;

      } else {
        // NORMAL MODE
        document.getElementById('storeName').innerText = storeName;
        document.getElementById('estText').innerText = "est. 2026 ‚Ä¢ digital receipt";
        document.getElementById('asciiDisplay').innerText = ascii;
        document.getElementById('loyaltySection').style.display = 'block';

        let currentTotal = 0;
        let pool = [...commonItems];
        moods[moodKey].items.forEach(i => pool.push({name: i, price: 20.00}));
        const count = Math.floor(Math.random() * 3) + 3; // 3 to 5 items
        const shuffled = pool.sort(() => 0.5 - Math.random());
        const selected = shuffled.slice(0, count);
        if (bonusItem) selected.unshift(bonusItem);

        let html = '';
        selected.forEach(i => {
          currentTotal += i.price;
          html += `<div class="item"><span>1x ${i.name}</span><span>$${i.price.toFixed(2)}</span></div>`;
        });
        document.getElementById('itemList').innerHTML = html;
        document.getElementById('totalLabel').innerText = "TOTAL:";
        document.getElementById('totalText').innerText = `$${currentTotal.toFixed(2)}`;

        lifetimeSpend += currentTotal;
        localStorage.setItem('loyaltySpend', lifetimeSpend);
        
        // RANDOM IDENTITY GENERATOR
        const randomIdentity = memberTitles[Math.floor(Math.random() * memberTitles.length)];
        
        document.getElementById('infoBubble').innerHTML = `
          CUSTOMER: ${nameDisplay.toUpperCase()}<br>
          MEMBER: ${randomIdentity}<br>
          LIFETIME DEBT: $${lifetimeSpend.toFixed(0)}
        `;

        // SCENT & STAMPS
        const finalScent = scentOverride || getSignatureScent();
        document.getElementById('scentDisplay').innerText = `SIGNATURE SCENT: ${finalScent}`;
        
        const stampsFilled = totalReceipts % 5;
        let stampString = "";
        for(let i=0; i<5; i++) stampString += (i < stampsFilled) ? "‚ô• " : "‚ô° ";
        document.getElementById('stampsDisplay').innerText = stampString;

        // EXTRAS (Coupon vs Forecast)
        const bottomDiv = document.getElementById('bottomExtras');
        if (Math.random() < 0.3) {
           const coup = coupons[Math.floor(Math.random() * coupons.length)];
           bottomDiv.innerHTML = `<div class="coupon">‚úÇ ${coup} ‚úÇ</div>`;
        } else {
           const fort = fortunes[Math.floor(Math.random() * fortunes.length)];
           bottomDiv.innerHTML = `<div class="forecast">${fort}</div><div class="barcode">|| | ||| || |||</div>`;
        }
      }

      document.getElementById('controls').style.display = 'none';
      document.getElementById('receiptContainer').style.display = 'block';
    }

    document.addEventListener('click', (e) => {
      const container = document.getElementById('receiptContainer');
      if (container.style.display === 'block' && (e.target.closest('.receipt-container') || e.target.closest('.receipt'))) {
        document.getElementById('controls').style.display = 'flex';
        container.style.display = 'none';
        document.getElementById('nameInput').value = ""; 
        updateDisplay(); 
      }
    });

    if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
  </script>
</body>
</html>
