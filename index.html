<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Cosmic Care</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="apple-mobile-web-app-status-bar-style" content="white">
  <meta name="theme-color" content="#ffffff">

  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600;700&family=Courier+Prime&family=Caveat:wght@700&family=VT323&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #f3e5f5;
      --accent: #ab47bc;
      --text: #4a148c;
      --paper: #fff;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: "Quicksand", sans-serif;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.5s ease;
      padding: 20px;
      box-sizing: border-box;
    }
    
    /* GHOST MODE CLASS */
    body.ghost-mode {
      --bg: #e0e0e0;
      --accent: #757575;
      --text: #000;
      --paper: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(10px);
    }

    /* CONTROLS */
    .controls { width: 100%; max-width: 360px; display: flex; flex-direction: column; gap: 10px; }
    
    .name-box {
      background: rgba(255,255,255,0.9); border: 2px solid var(--accent); padding: 16px;
      border-radius: 25px; font-family: "Quicksand", sans-serif; font-weight: 700;
      font-size: 1.1rem; text-align: center; color: var(--text); outline: none;
      box-shadow: 0 5px 20px rgba(0,0,0,0.05);
    }

    .sign-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }

    .sign-btn {
      background: rgba(255,255,255,0.8); border: 2px solid var(--accent); color: var(--accent);
      padding: 8px 2px; border-radius: 12px; font-weight: 700; font-size: 0.6rem;
      cursor: pointer; text-transform: uppercase; display: flex; align-items: center; justify-content: center; min-height: 40px;
    }
    .sign-btn:active { transform: scale(0.95); background: var(--accent); color: #fff; }

    .menu-bar { display: flex; gap: 5px; margin-top: 5px; }
    .menu-btn {
      flex: 1; border: none; padding: 10px 5px; border-radius: 12px; font-weight: bold;
      cursor: pointer; font-size: 1.2rem; background: rgba(255,255,255,0.6); transition: 0.2s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .menu-btn:active { transform: scale(0.95); background: var(--accent); color: white; }

    .stats-header {
      display: flex; justify-content: space-between; background: rgba(255,255,255,0.5);
      padding: 10px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; color: var(--text);
      backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.5);
    }

    /* SCREENS */
    .screen { perspective: 1000px; width: 100%; max-width: 340px; display: none; margin-top: 20px; }
    
    .paper-sheet {
      background: var(--paper); padding: 30px 25px; font-family: "Courier Prime", monospace;
      color: var(--text); box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      animation: popIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; position: relative; text-align: center;
      padding-bottom: 60px;
      --mask: radial-gradient(10px at 50% 100%, #0000 98%, #000 100%) 50% calc(100% - 10px)/20px 100% repeat-x;
      -webkit-mask: var(--mask); mask: var(--mask);
    }

    .checklist-item {
      margin-bottom: 12px; font-size: 1rem; text-align: left; display: flex; align-items: center; gap: 10px;
      cursor: pointer; transition: 0.2s; padding: 5px; border-radius: 5px;
    }
    .checklist-item:active { background: rgba(0,0,0,0.05); transform: scale(0.98); }
    .checklist-item.checked { text-decoration: line-through; opacity: 0.5; color: var(--accent); }

    .id-card {
      background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border-radius: 15px; padding: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.2); font-family: "VT323", monospace; position: relative;
      overflow: hidden; border: 1px solid rgba(255,255,255,0.5); animation: flipIn 0.8s ease forwards;
    }
    .id-header { background: var(--accent); color: white; padding: 5px 10px; font-size: 1.2rem; letter-spacing: 2px; margin: -20px -20px 15px -20px; text-align: center; }
    .id-content { display: flex; gap: 15px; align-items: center; }
    .id-photo { width: 80px; height: 100px; background: white; border: 2px solid var(--accent); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; white-space: pre; line-height: 1; }
    .id-details { text-align: left; flex: 1; line-height: 1.1; }
    .id-label { font-size: 0.8rem; opacity: 0.6; margin-top: 6px; }
    .id-value { font-size: 1.1rem; color: var(--text); font-weight: bold; text-transform: uppercase;}
    .holo-overlay {
      position: absolute; top:0; left:0; right:0; bottom:0;
      background: linear-gradient(115deg, transparent 40%, rgba(255,255,255,0.4) 45%, transparent 50%);
      pointer-events: none; background-size: 200% 200%; animation: holoShine 3s infinite linear;
    }

    .gacha-machine { background: #ffecb3; border: 4px solid #ffca28; border-radius: 20px; padding: 20px; text-align: center; animation: popIn 0.5s ease; box-shadow: 0 10px 0 #ffca28; }
    .gacha-globe { width: 150px; height: 150px; background: rgba(255,255,255,0.5); border-radius: 50%; border: 3px solid #ffca28; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 3rem; }
    .spin-btn { background: #ff6f00; color: white; border: none; padding: 10px 25px; border-radius: 10px; font-family: "VT323", monospace; font-size: 1.5rem; cursor: pointer; box-shadow: 0 5px 0 #e65100; }
    .spin-btn:active { transform: translateY(5px); box-shadow: none; }
    .gacha-prize { margin-top: 20px; padding: 10px; background: white; border-radius: 10px; border: 2px dashed #ffca28; display: none; }

    .close-hint { text-align:center; color: var(--text); font-size:0.8rem; margin-top:20px; opacity:0.6; cursor: pointer; }
    .nav-btn { background: #ff80ab; color: white; border: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; cursor: pointer; margin-top: 10px; }
    .item { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; }
    .inventory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 15px; }
    .inv-item { background: rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; padding: 5px; font-size: 0.65rem; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 65px; text-align: center; }
    .inv-item.gacha { border: 1px solid #7c4dff; background: #ede7f6; }
    .inv-item.legendary { border: 1px solid #ffd700; background: #fffde7; }
    
    .report-grid { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; margin-bottom: 20px; }
    .pixel { width: 18px; height: 18px; border-radius: 4px; background: #eee; }
    .progress-bar { height: 8px; background: #eee; border-radius: 4px; margin-bottom: 15px; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--accent); }
    .planet-row { display:flex; justify-content:space-between; border-bottom:1px solid rgba(0,0,0,0.1); padding:8px 0; font-size:0.9rem;}

    @keyframes popIn { 0% { opacity: 0; transform: translateY(40px) scale(0.95); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
    @keyframes holoShine { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); } }
  </style>
</head>
<body>

  <div class="controls" id="controls">
    <div class="stats-header">
      <span id="headerDebt">üí∏ $0</span>
      <span id="headerAura">‚ú® 0 AURA</span>
    </div>
    <br>
    <input type="text" id="nameInput" class="name-box" placeholder="Your Name (or Secret Code)">
    <div class="sign-grid" id="signGrid"></div>
    
    <div class="menu-bar">
      <button class="menu-btn" onclick="openScreen('bag')" title="Backpack">üéí</button>
      <button class="menu-btn" onclick="openScreen('report')" title="Aura Report">üìä</button>
      <button class="menu-btn" onclick="openScreen('rx')" title="Doctor">üíä</button>
      <button class="menu-btn" onclick="openScreen('gacha')" title="Gacha">üîÆ</button>
      <button class="menu-btn" onclick="openScreen('id')" title="ID Card">ü™™</button>
    </div>
  </div>

  <div class="screen" id="receiptScreen">
    <div class="paper-sheet">
      <div id="asciiDisplay" style="white-space: pre; font-size: 0.8rem; margin-bottom:10px; font-weight:bold; opacity:0.8;"></div>
      <div style="border: 2px solid var(--accent); border-radius: 50px; padding: 5px 20px; display:inline-block; margin-bottom:5px;">
        <h2 style="margin:0; font-size:1.4rem; color:var(--accent);" id="storeName">...</h2>
      </div>
      <div style="font-size:0.75rem; opacity:0.7; margin-bottom:20px;">est. 2026 ‚Ä¢ digital receipt</div>
      <div id="infoBubble" style="background:rgba(255,255,255,0.1); padding:10px; border-radius:15px; margin-bottom:20px; font-size:0.85rem; line-height:1.5;"></div>
      <div id="itemList" style="text-align:left; margin-bottom:20px;"></div>
      <div style="border-top:2px dashed var(--accent); opacity:0.5; margin:20px 0;"></div>
      <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:1.2rem; color:var(--accent);">
        <span id="totalLabel">TOTAL:</span><span id="totalText">$0.00</span>
      </div>
      <div id="loyaltySection" style="margin-top:25px; border:1px solid var(--accent); border-radius:15px; padding:10px; font-size:0.8rem;">
        <div id="scentDisplay">SCENT: ???</div>
        <div style="border-top:1px dashed var(--accent); margin:5px 0;"></div>
        <div id="stampsDisplay" style="font-size:1.5rem; letter-spacing:5px;">‚ô°‚ô°‚ô°‚ô°‚ô°</div>
      </div>
      <div id="bottomExtras" style="margin-top:20px;"></div>
      <div id="rxNavContainer" style="margin-top:15px;"></div>
    </div>
    <div class="close-hint" onclick="closeAll()">tap to close</div>
  </div>

  <div class="screen" id="bagScreen">
    <div class="paper-sheet">
      <h2>MY BACKPACK</h2>
      <div style="font-size:0.8rem; margin-bottom:10px;">digital hoard ‚Ä¢ <span id="bagCount">0</span> items</div>
      <div class="inventory-grid" id="inventoryGrid"></div>
    </div>
    <div class="close-hint" onclick="closeAll()">tap to close</div>
  </div>

  <div class="screen" id="reportScreen">
    <div class="paper-sheet">
      <h2>AURA CHART</h2>
      <div style="font-size:0.8rem; margin-bottom:15px;">cosmic alignment</div>
      <div id="astrologyChart" style="text-align:left; background:rgba(0,0,0,0.03); padding:15px; border-radius:10px; margin-bottom:20px;"></div>
      <div style="text-align:left; font-size:0.8rem; font-weight:bold; margin-bottom:5px;">RECENT PIXELS:</div>
      <div id="pixelGrid" style="display:flex; flex-wrap:wrap; gap:4px; justify-content:center; margin-bottom:20px;"></div>
      <div id="vibeForecast" style="font-style:italic; font-size:0.85rem; color:var(--accent); border:1px dashed var(--accent); padding:10px;"></div>
    </div>
    <div class="close-hint" onclick="closeAll()">tap to close</div>
  </div>

  <div class="screen" id="rxScreen">
    <div style="background:#fff0f5; padding:25px; border-radius:10px; border:4px solid #ff80ab; color:#880e4f; box-shadow: 0 15px 50px rgba(0,0,0,0.15);">
      <div style="display:flex; justify-content:space-between; border-bottom:2px solid #ff80ab; padding-bottom:10px; margin-bottom:20px;">
        <div style="font-size:2.5rem; font-weight:900; font-style:italic;">Rx</div>
        <div style="text-align:right; font-weight:bold; font-size:0.8rem;">DR. COSMIC</div>
      </div>
      <div style="text-align:left; margin-bottom:15px;">
        <div style="font-size:0.7rem; font-weight:bold; opacity:0.7;">PATIENT</div>
        <div id="rxName" style="font-size:1.1rem; font-weight:700; border-bottom:1px dashed #ff80ab;">GUEST</div>
      </div>
      <div style="text-align:left; margin-bottom:15px;">
        <div style="font-size:0.7rem; font-weight:bold; opacity:0.7;">DIAGNOSIS</div>
        <div id="rxDiagnosis" style="font-family:'Caveat',cursive; font-size:1.6rem; color:#000080;">...</div>
      </div>
      <div style="text-align:left; margin-bottom:15px;">
        <div style="font-size:0.7rem; font-weight:bold; opacity:0.7;">PRESCRIPTION</div>
        <div id="rxTreatment" style="font-family:'Caveat',cursive; font-size:1.6rem; color:#000080;">...</div>
      </div>
      <div style="text-align:right; font-family:'Caveat', cursive; font-size:1.5rem; border-top:2px solid #ff80ab; margin-top:30px;">Dr. Cosmic</div>
    </div>
    <div class="close-hint" onclick="closeAll()">tap to close</div>
  </div>

  <div class="screen" id="idScreen">
    <div class="id-card">
      <div class="holo-overlay"></div>
      <div class="id-header">CITIZEN OF THE INTERNET</div>
      <div class="id-content">
        <div class="id-photo" id="idPhoto">?</div>
        <div class="id-details">
          <div class="id-label">NAME</div>
          <div class="id-value" id="idName">GUEST</div>
          <div class="id-label">STATUS</div>
          <div class="id-value" id="idTitle">NPC</div>
          <div class="id-label">AURA SCORE</div>
          <div class="id-value" id="idAura">0</div>
        </div>
      </div>
      <div style="display:flex; justify-content:space-between; margin-top:15px;">
        <div><div class="id-label">SCENT</div><div class="id-value" id="idScent" style="font-size:0.9rem;">-</div></div>
        <div style="text-align:right;"><div class="id-label">DEBT</div><div class="id-value" id="idWorth" style="color:#d32f2f;">$0</div></div>
      </div>
    </div>
    <div class="close-hint" onclick="closeAll()">tap to close</div>
  </div>

  <div class="screen" id="gachaScreen">
    <div class="gacha-machine">
      <h2 style="margin:0; color:#e65100;">COSMIC GACHA</h2>
      <div style="font-size:0.8rem; margin-bottom:15px;">Cost: $300 Debt / Spin<br><span style="color:red; font-size:0.7rem;">Requires > -5000 Aura</span></div>
      <div class="gacha-globe" id="gachaGlobe">üîÆ</div>
      <button class="spin-btn" onclick="spinGacha()">SPIN ($300)</button>
      <div class="gacha-prize" id="gachaPrize">
        <div style="font-size:0.8rem; font-weight:bold; color:#7c4dff;">YOU GOT:</div>
        <div id="prizeName" style="font-size:1.2rem; margin:10px 0;">???</div>
        <div id="prizeRarity" style="font-size:0.7rem; text-transform:uppercase;">COMMON</div>
      </div>
    </div>
    <div class="close-hint" onclick="closeAll()">tap to close</div>
  </div>

  <script>
    // --- DATA ---
    const shopNames = ["THE MALL", "GIRL WORLD", "PLASTIC DREAMS", "ARCHIVE", "ANGEL DEPT", "VELVET ROPE", "LIMITED ED.", "SOLDOUT", "MAIN CHAR."];
    const arts = { default: "‚ô•", nature: "    /\\\n   /  \\\n  /____\\ \n    ||", ocean: ".~ .~~~ ..~", stars: "‚ú®  ‚ú¶  ‚ú®", bow: "  /\\ /\\\n  ( o.o )\n   > ^ <", cyber: "[ o_o ]", happy: "^___^", neutral: "-___-" };

    // ECONOMY BALANCING
    // range: [minSpend, maxSpend]
    const moods = {
      rotting: { color: "#78909c", bg: "#eceff1", scent: "BEDSHEETS", art: arts.default, avatar: "_(:3 „Äç‚à†)_", aura: -500, range:[10, 30], items: ["Doomscrolling", "Dirty Hair", "Uber Eats"] },
      thriving: { color: "#43a047", bg: "#e8f5e9", scent: "MATCHA", art: "üåø", avatar: "( Ôæâ^œâ^)Ôæâ", aura: 500, range:[40, 100], items: ["Green Juice", "Yoga Mat", "Skin Glow"] },
      manic: { color: "#ff9100", bg: "#fff3e0", scent: "RED BULL", art: "‚ö°", avatar: "( ‚óâ_‚óâ )", aura: -2000, range:[200, 600], items: ["Impulse Buy", "Fast Talking", "God Complex"] },
      numb: { color: "#bdbdbd", bg: "#fafafa", scent: "STATIC", art: "...", avatar: "( -_- )", aura: -200, range:[5, 15], items: ["Staring at Wall", "Nothing", "White Noise"] },
      delusional: { color: "#f06292", bg: "#fce4ec", scent: "FROSTING", art: arts.bow, avatar: "( Àò ¬≥Àò)‚ô•", aura: -100, range:[50, 150], items: ["Fake Scenario", "He Loves Me", "Fantasy"] },
      yearning: { color: "#7e57c2", bg: "#ede7f6", scent: "RAIN", art: "‚òÅÔ∏è", avatar: "( ; œâ ; )", aura: 100, range:[20, 60], items: ["Poetry", "Old Photos", "Sad Music"] },
      hating: { color: "#d32f2f", bg: "#ffebee", scent: "SMOKE", art: "‚úñ", avatar: "( ¬¨_¬¨ )", aura: -1000, range:[10, 50], items: ["Blocking Him", "Side Eye", "Judgment"] },
      healing: { color: "#8d6e63", bg: "#efebe9", scent: "SAGE", art: "üïØÔ∏è", avatar: "( ‚ú®_‚ú® )", aura: 1000, range:[30, 80], items: ["Therapy", "Journaling", "Boundaries"] },
      spiraling: { color: "#304ffe", bg: "#e8eaf6", scent: "WINE", art: "üåÄ", avatar: "( @ _ @ )", aura: -800, range:[50, 200], items: ["Overthinking", "Panic", "Regret"] },
      lurking: { color: "#2e7d32", bg: "#e8f5e9", scent: "SCREEN", art: "üëÅÔ∏è", avatar: "( üëÅÔ∏è ·¥• üëÅÔ∏è )", aura: -200, range:[0, 20], items: ["Screenshots", "Private Tab", "Research"] },
      posting: { color: "#00b0ff", bg: "#e1f5fe", scent: "HAIRSPRAY", art: "üì∏", avatar: "( ü§≥ )", aura: 200, range:[0, 100], items: ["Drafts", "Clout", "Validation"] },
      productive: { color: "#fdd835", bg: "#fffde7", scent: "PAPER", art: "üìù", avatar: "( √≤_√≥ )", aura: 500, range:[15, 60], items: ["Emails", "Iced Coffee", "To-Do List"] },
      silly: { color: "#ff4081", bg: "#fce4ec", scent: "BUBBLEGUM", art: arts.happy, avatar: "( ü§™ )", aura: 800, range:[5, 25], items: ["Clown Nose", "Giggles", "Prank Call"] },
      grateful: { color: "#ffd700", bg: "#fffde7", scent: "SUNSHINE", art: arts.happy, avatar: "( üôè )", aura: 1000, range:[0, 50], items: ["Thank You Note", "Warm Hug", "Flowers"] },
      chill: { color: "#81d4fa", bg: "#e1f5fe", scent: "OCEAN AIR", art: arts.neutral, avatar: "( ÀòœâÀò )", aura: 500, range:[20, 40], items: ["Lo-Fi Beats", "Hoodie", "Snack"] },
      bored: { color: "#b0bec5", bg: "#eceff1", scent: "CARDBOARD", art: arts.neutral, avatar: "( ._. )", aura: 0, range:[5, 15], items: ["Ceiling Tile", "Daydream", "Nap"] },
      sleepi: { color: "#9fa8da", bg: "#e8eaf6", scent: "LAVENDER", art: "zZz", avatar: "( ·¥ó _ ·¥ó )", aura: 200, range:[0, 20], items: ["Eye Mask", "Melatonin", "Teddy Bear"] },
      ouch: { color: "#e57373", bg: "#ffebee", scent: "OINTMENT", art: "T_T", avatar: "( > _ < )", aura: -500, range:[20, 50], items: ["Heating Pad", "Band-aid", "Pain Potion"] },
      dizzy: { color: "#80cbc4", bg: "#e0f2f1", scent: "GINGER", art: "@_@", avatar: "( @ . @ )", aura: -200, range:[10, 30], items: ["Ginger Ale", "Crackers", "Horizon Line"] },
      relaxed: { color: "#4db6ac", bg: "#e0f2f1", scent: "EUCALYPTUS", art: "~_~", avatar: "( u _ u )", aura: 800, range:[50, 150], items: ["Incense", "Bath Bomb", "Herbal Tea"] },
      dissociative: { color: "#cfd8dc", bg: "#f5f5f5", scent: "NOTHING", art: "___", avatar: "( o . o )", aura: -50, range:[0, 10], items: ["Ice Cube", "Reality Anchor", "Hoodie"] }
    };

    const medicalDb = {
      rotting: { diagnoses: ["Bed-Gravity Syndrome", "Vitamin D Deficiency"], treatments: ["Open the Blinds", "Wash Your Face", "Stand Up for 1m"], severe: ["CRITICAL BED FUSION", "MOSS GROWTH DETECTED"] },
      thriving: { diagnoses: ["Main Character Energy", "Excessive Slay"], treatments: ["Keep Slaying", "Take a Selfie", "Write it Down"], severe: ["EGO OVERLOAD", "TOO POWERFUL"] },
      manic: { diagnoses: ["System Overload", "Zoomies"], treatments: ["Lay on the Floor", "Box Breathing (4s)", "Decaf Tea"], severe: ["VIBE VELOCITY UNSAFE", "CRASH IMMINENT"] },
      numb: { diagnoses: ["Sensory Deprivation", "Static Noise Brain"], treatments: ["Hold Ice Cube", "Eat Sour Candy", "Cold Water Splash"], severe: ["CONNECTION LOST", "BUFFERING..."] },
      delusional: { diagnoses: ["Fantasy Fever", "Reality Detachment"], treatments: ["Call a Real Friend", "Touch a Wall", "List 3 Facts"], severe: ["PLOT HOLE DETECTED", "TERMINAL DELULU"] },
      yearning: { diagnoses: ["Heart Acheness", "Nostalgia Poisoning"], treatments: ["Write & Burn It", "Make New Art", "Call Someone New"], severe: ["PAST LIFE LEAKAGE", "MEMORY LOOP"] },
      hating: { diagnoses: ["Petty Fever", "Sour Candy Soul"], treatments: ["List 3 Good Things", "Compliment Someone", "Log Off"], severe: ["TOXICITY CRITICAL", "BITTER ROOT"] },
      healing: { diagnoses: ["Growth Spurt", "Metamorphosis"], treatments: ["Rest & Hydrate", "Gentle Stretch", "Proud of You"], severe: ["BUTTERFLY EFFECT", "RADIANT AURA"] },
      spiraling: { diagnoses: ["Looping Thoughts", "System Error"], treatments: ["5-4-3-2-1 Method", "Weighted Blanket", "Look at the Sky"], severe: ["LOGIC FAILURE", "INFINITE LOOP"] },
      lurking: { diagnoses: ["Invisibility Cloak", "Observer Mode"], treatments: ["Post a Comment", "Be Perceived", "Step Away"], severe: ["GHOST SYNDROME", "DATA ONLY"] },
      posting: { diagnoses: ["Validation Seeking", "Performance Mode"], treatments: ["Airplane Mode (1hr)", "Read a Book", "Private Journal"], severe: ["CLOUT POISONING", "ALGORITHM ADDICTION"] },
      productive: { diagnoses: ["Hustle Culture Flu", "Human Doing"], treatments: ["Do Nothing (5m)", "Unclench Jaw", "Look at a Tree"], severe: ["MACHINE MODE", "BATTERY DRAIN"] },
      silly: { diagnoses: ["Chronic Goofiness", "Clownery"], treatments: ["Do a Little Dance", "Make Someone Laugh", "Enjoy the Joy"], severe: ["HONK HONK", "CIRCUS BRAIN"] },
      grateful: { diagnoses: ["Heart Expansion", "Peaceful Mind"], treatments: ["Say Thank You", "Soak it In", "Share the Love"], severe: ["BLESSED STATE", "LIGHT BEAM"] },
      chill: { diagnoses: ["Low Cortisol", "Vibe Stabilization"], treatments: ["Stay Hydrated", "Enjoy the Quiet", "Nap"], severe: ["ZERO KELVIN", "STASIS"] },
      bored: { diagnoses: ["Dopamine Deficiency", "Buffering"], treatments: ["Read a Page", "Draw a Circle", "Clean One Thing"], severe: ["GREY SCREEN", "NO SIGNAL"] },
      sleepi: { diagnoses: ["Eepy Syndrome", "Battery Low"], treatments: ["Nap Immediately", "Cozy Socks", "Do Not Disturb"], severe: ["POWER OFF", "SYSTEM SHUTDOWN"] },
      ouch: { diagnoses: ["Glitchy Body", "Physical Form Error"], treatments: ["Magic Kiss", "Heating Pad", "Complain Loudly"], severe: ["HARDWARE DAMAGE", "ERROR 500"] },
      dizzy: { diagnoses: ["Spin Cycle", "Earthquake Simulator"], treatments: ["Lay Flat", "Close Eyes", "Grounding"], severe: ["GYROSCOPE FAIL", "TILT MODE"] },
      relaxed: { diagnoses: ["Zen State", "Vibe Alignment"], treatments: ["Stay Here", "Deep Breath", "Enjoy It"], severe: ["LIQUID STATE", "MELTING"] },
      dissociative: { diagnoses: ["Loading Screen", "Connection Lost"], treatments: ["Touch Ice", "Name 5 Things", "Stomp Feet"], severe: ["SERVER DISCONNECT", "404 BODY NOT FOUND"] },
      general: { diagnoses: ["Human Condition", "Vibe Shift"], treatments: ["Drink Water", "Deep Breath", "Be Kind to Self"], severe: ["CRITICAL ERROR", "REBOOT NEEDED"] }
    };

    const forecasts = [
      "Mercury is in retrograde. Hide your phone.",
      "Star alignment suggests buying a latte.",
      "Cosmic energy is low. Rotting is advised.",
      "Aura is bright. Post that selfie.",
      "Avoid Exes today. High risk of cringe.",
      "Money is fake but the vibes are real.",
      "You are the main character today.",
      "System update required. Take a nap."
    ];

    const allItems = [
      {name: "Iced Oat Latte", rare: false}, {name: "Sonny Angel", rare: false}, {name: "Claw Clip", rare: false}, 
      {name: "Satin Ribbon", rare: false}, {name: "Platform Shoes", rare: true}, {name: "Blind Box", rare: false}, 
      {name: "Digicam", rare: true}, {name: "Phone Charm", rare: false}, {name: "Unread Book", rare: false}, 
      {name: "Thrift Find", rare: false}, {name: "Delivery Fee", rare: false}, {name: "Strawberry Milk", rare: false}, 
      {name: "Tote Bag", rare: false}, {name: "Face Mask", rare: false}, {name: "Concert Tickets", rare: true}, 
      {name: "New Piercing", rare: true}, {name: "Vending Machine", rare: false}, {name: "Oat Milk Tax", rare: false}, 
      {name: "Lip Gloss", rare: false}, {name: "Girl Dinner", rare: false}, {name: "Therapy", rare: true}, 
      {name: "Little Walk", rare: false}, {name: "Sweet Treat", rare: false}, {name: "Spotify Premium", rare: false}, 
      {name: "Vintage Lamp", rare: true}, {name: "Cat Ear Headphones", rare: true}, {name: "Crystal", rare: false}, 
      {name: "Tarot Deck", rare: false}, {name: "Mechanical Keyboard", rare: true}, {name: "Matcha Whisk", rare: false}, 
      {name: "Weighted Blanket", rare: true}, {name: "Essential Oil", rare: false}, {name: "Film Roll", rare: false}, 
      {name: "Succulent", rare: false}, {name: "Fuzzy Socks", rare: false}, {name: "Sheet Mask", rare: false}, 
      {name: "Crochet Top", rare: false}, {name: "Vinyl Record", rare: false}, {name: "Rare Sticker", rare: true}, 
      {name: "Sanrio Plush", rare: false}, {name: "Bubble Tea", rare: false}, {name: "Crocs", rare: false}, 
      {name: "Designer Bag", rare: true}, {name: "Emotional Support Bottle", rare: false}
    ];

    const gachaLoot = {
      common: ["Glitch Water", "404 Error", "Pixel Heart", "Stardust", "Lucky Penny", "Old Receipt", "Broken Link", "Loading Bar", "Static Noise", "Cloud Storage"],
      rare: ["Angel Wings", "Devil Horns", "Invisibility Potion", "Admin Key", "Moon Rock", "Fairy Dust", "Holographic Sticker", "Void Ticket", "Crystal Ball", "Love Potion"],
      legendary: ["The Moon", "Ban Hammer", "Source Code", "Golden Halo", "Time Machine", "Main Character Script", "The Algorithm"]
    };

    const selfCareTasks = ["Drink water", "Face mask", "Phone DND 1hr", "Stretch", "Clean a corner", "Listen to music", "Go outside", "Unclench jaw"];
    const fortunes = ["LUCKY NUMBER: 444", "AURA: PINK", "MANIFESTING: $$$", "VIBE: IMMACULATE", "AVOID: EXES"];
    const coupons = ["VALID FOR: 1 NAP", "VOUCHER: 1 FREE CRY", "ADMIT ONE: TO THE DRAMA", "COUPON: TREAT YOURSELF"];

    // STATE
    let lifetimeSpend = parseFloat(localStorage.getItem('loyaltySpend') || 0);
    let lifetimeAura = parseInt(localStorage.getItem('loyaltyAura') || 0);
    let totalReceipts = parseInt(localStorage.getItem('loyaltyCount') || 0);
    let moodCounts = JSON.parse(localStorage.getItem('loyaltyMoods') || '{}');
    let moodHistory = JSON.parse(localStorage.getItem('loyaltyHistory') || '[]');
    let inventory = JSON.parse(localStorage.getItem('loyaltyInventory') || '{}');

    // UTILS
    function updateDisplay() {
      document.getElementById('headerDebt').innerText = `üí∏ $${Math.floor(lifetimeSpend)}`;
      document.getElementById('headerAura').innerText = `‚ú® ${lifetimeAura} AURA`;
    }

    function getRank(aura) {
      if (aura < -5000) return "CURSED OBJECT";
      if (aura < -1000) return "ENERGY VAMPIRE";
      if (aura < 0) return "BAD VIBES";
      if (aura < 5000) return "NPC";
      if (aura < 10000) return "MAIN CHARACTER";
      return "ETHEREAL BEING";
    }

    function closeAll() {
      document.querySelectorAll('.screen').forEach(el => el.style.display = 'none');
      document.getElementById('controls').style.display = 'flex';
      updateDisplay();
    }

    function openScreen(type) {
      closeAll();
      document.getElementById('controls').style.display = 'none';
      const name = document.getElementById('nameInput').value || "Guest";
      
      // CHEAT CODES CHECK
      if (type === 'gacha' && name.toLowerCase() === 'rich') { lifetimeSpend += 1000; updateDisplay(); alert("CHEAT ACTIVATED: +$1000"); return; }
      if (name.toLowerCase() === 'cleanse') { lifetimeAura = 0; updateDisplay(); alert("CHEAT ACTIVATED: AURA RESET"); }
      if (name.toLowerCase() === 'ghost') { document.body.classList.toggle('ghost-mode'); alert("GHOST MODE TOGGLED"); }
      if (name.toLowerCase() === 'void') { inventory = {}; alert("INVENTORY WIPED"); }

      if(type==='bag') { renderBag(); document.getElementById('bagScreen').style.display='block'; }
      if(type==='report') { renderReport(name); document.getElementById('reportScreen').style.display='block'; }
      if(type==='rx') { renderRx(name); document.getElementById('rxScreen').style.display='block'; }
      if(type==='gacha') { document.getElementById('gachaScreen').style.display='block'; }
      if(type==='id') { renderID(name); document.getElementById('idScreen').style.display='block'; }
    }

    // RENDERERS
    function renderID(name) {
      let topMood = "numb"; let max=0;
      for(const [m,c] of Object.entries(moodCounts)){if(c>max){max=c;topMood=m;}}
      const theme = moods[topMood];
      document.getElementById('idName').innerText = name.toUpperCase();
      document.getElementById('idTitle').innerText = getRank(lifetimeAura);
      document.getElementById('idAura').innerText = lifetimeAura;
      document.getElementById('idScent').innerText = theme ? theme.scent : "???";
      document.getElementById('idWorth').innerText = `-$${Math.floor(lifetimeSpend)}`;
      document.getElementById('idPhoto').innerText = theme ? theme.avatar : "( ? )";
    }

    function renderReport(name) {
      // CALC SUN/MOON/RISING
      const sortedMoods = Object.entries(moodCounts).sort((a,b) => b[1] - a[1]);
      const sun = sortedMoods[0] ? sortedMoods[0][0] : "Unknown";
      const moon = sortedMoods[1] ? sortedMoods[1][0] : "Unknown";
      const rising = moodHistory.length > 0 ? moodHistory[moodHistory.length - 1] : "Unknown";
      
      const chartHtml = `
        <div class="planet-row"><span>‚òÄÔ∏è SUN (Core)</span><span>${sun.toUpperCase()}</span></div>
        <div class="planet-row"><span>üåô MOON (Inner)</span><span>${moon.toUpperCase()}</span></div>
        <div class="planet-row"><span>‚¨ÜÔ∏è RISING (Now)</span><span>${rising.toUpperCase()}</span></div>
      `;
      document.getElementById('astrologyChart').innerHTML = chartHtml;
      
      const pxDiv=document.getElementById('pixelGrid'); pxDiv.innerHTML='';
      moodHistory.slice(-30).forEach(m=>{
        const d=document.createElement('div'); d.className='pixel'; d.style.background=moods[m]?moods[m].color:'#eee'; pxDiv.appendChild(d);
      });
      
      const forecast = forecasts[Math.floor(Math.random() * forecasts.length)];
      document.getElementById('vibeForecast').innerText = `COSMIC FORECAST: ${forecast}`;
    }

    function renderRx(name, specificMood = null) {
      let target = specificMood;
      if(!target) {
        if (moodHistory.length > 0) target = moodHistory[moodHistory.length - 1]; 
        else target = "general";
      }
      const data = medicalDb[target] || medicalDb.general;
      
      // CHECK STREAK
      const last3 = moodHistory.slice(-3);
      const isStreak = last3.length === 3 && last3.every(m => m === last3[0]) && last3[0] === target;
      
      const diagList = isStreak && data.severe ? data.severe : data.diagnoses;
      const diag = diagList[Math.floor(Math.random() * diagList.length)];
      const treat = data.treatments[Math.floor(Math.random() * data.treatments.length)];
      
      document.getElementById('rxName').innerText=name.toUpperCase();
      document.getElementById('rxDiagnosis').innerText=diag;
      document.getElementById('rxTreatment').innerText=treat;
    }

    function renderBag() {
      const g = document.getElementById('inventoryGrid'); g.innerHTML='';
      let t=0; Object.entries(inventory).sort((a,b)=>b[1]-a[1]).forEach(([n,c])=>{
        t+=c;
        let cls='';
        if(gachaLoot.legendary.includes(n)) cls='legendary';
        else if(gachaLoot.rare.includes(n)) cls='gacha';
        else if(allItems.find(i=>i.name===n && i.rare)) cls='legendary';
        const div=document.createElement('div'); div.className=`inv-item ${cls}`;
        div.innerHTML=`<div style="font-weight:bold; color:#ab47bc;">x${c}</div><div style="opacity:0.8;">${n}</div>`;
        g.appendChild(div);
      });
      document.getElementById('bagCount').innerText=t;
    }

    function spinGacha() {
      if (lifetimeAura < -5000) { alert("‚õî BAD VIBES DETECTED. MACHINE JAMMED. PLEASE HEAL AURA."); return; }
      if (lifetimeSpend < 300) { alert("Need $300 Debt!"); return; }
      
      lifetimeSpend -= 300; localStorage.setItem('loyaltySpend', lifetimeSpend); updateDisplay();
      
      const globe=document.getElementById('gachaGlobe'); globe.style.animation="shake 0.5s";
      setTimeout(()=>{ globe.style.animation=""; 
        const r=Math.random(); 
        let t='common'; 
        if(r>0.95) t='legendary'; // 5%
        else if(r>0.70) t='rare'; // 25%
        
        const item=gachaLoot[t][Math.floor(Math.random()*gachaLoot[t].length)];
        inventory[item]=(inventory[item]||0)+1; localStorage.setItem('loyaltyInventory', JSON.stringify(inventory));
        document.getElementById('prizeName').innerText=item;
        document.getElementById('prizeRarity').innerText=t.toUpperCase();
        document.getElementById('gachaPrize').style.display='block';
      }, 500);
    }

    // --- GENERATE RECEIPT ---
    function generate(moodKey) {
      const name = document.getElementById('nameInput').value || "Guest";
      const theme = moods[moodKey];
      
      moodCounts[moodKey] = (moodCounts[moodKey]||0)+1; 
      localStorage.setItem('loyaltyMoods', JSON.stringify(moodCounts));
      moodHistory.push(moodKey); if(moodHistory.length>50) moodHistory.shift();
      localStorage.setItem('loyaltyHistory', JSON.stringify(moodHistory));
      totalReceipts++; localStorage.setItem('loyaltyCount', totalReceipts);
      
      lifetimeAura += theme.aura; localStorage.setItem('loyaltyAura', lifetimeAura);

      document.getElementById('controls').style.display = 'none';
      document.getElementById('receiptScreen').style.display = 'block';

      document.documentElement.style.setProperty('--bg', theme.bg);
      document.documentElement.style.setProperty('--accent', theme.color);
      document.documentElement.style.setProperty('--text', theme.color);
      document.getElementById('asciiDisplay').innerText = theme.art;

      if (totalReceipts % 5 === 0) {
        document.getElementById('storeName').innerText = "SELF CARE";
        document.getElementById('infoBubble').innerHTML = `STATUS: <b>REWARD UNLOCKED</b><br>Click tasks to claim Aura!`;
        const tasks = selfCareTasks.sort(()=>0.5-Math.random()).slice(0,5);
        let html = '';
        tasks.forEach(t => html += `<div class="checklist-item" onclick="claimTask(this)">‚òê ${t}</div>`);
        document.getElementById('itemList').innerHTML = html;
        document.getElementById('totalText').innerText = "PRICELESS";
        document.getElementById('loyaltySection').style.display = 'none';
        document.getElementById('rxNavContainer').innerHTML = "";
        document.getElementById('bottomExtras').innerHTML = `<div class="forecast">ENJOY YOUR BREAK</div>`;
      } else {
        document.getElementById('storeName').innerText = shopNames[Math.floor(Math.random()*shopNames.length)];
        let pool = [...allItems];
        theme.items.forEach(i => pool.push({name:i, rare:false})); // Specific mood items
        
        const count = Math.floor(Math.random() * 3) + 3;
        const selected = pool.sort(()=>0.5-Math.random()).slice(0, count);
        
        let html='', total=0;
        const minPrice = theme.range[0], maxPrice = theme.range[1];
        
        selected.forEach(i => {
          // Calculate variable price based on mood range
          const price = Math.random() * (maxPrice - minPrice) + minPrice;
          total += price;
          html += `<div class="item"><span>1x ${i.name}</span><span>$${price.toFixed(2)}</span></div>`;
          inventory[i.name] = (inventory[i.name]||0)+1;
        });
        localStorage.setItem('loyaltyInventory', JSON.stringify(inventory));
        
        document.getElementById('itemList').innerHTML = html;
        document.getElementById('totalText').innerText = `$${total.toFixed(2)}`;
        lifetimeSpend += total; localStorage.setItem('loyaltySpend', lifetimeSpend);

        document.getElementById('infoBubble').innerHTML = `MOOD: ${moodKey.toUpperCase()}<br>AURA CHANGE: ${theme.aura > 0 ? '+' : ''}${theme.aura}`;
        document.getElementById('loyaltySection').style.display = 'block';
        document.getElementById('rxNavContainer').innerHTML = `<button class="nav-btn" onclick="openScreen('rx')">NEED TREATMENT?</button>`;
        document.getElementById('rxNavContainer').onclick = () => renderRx(name, moodKey);
        
        document.getElementById('scentDisplay').innerText = `SCENT: ${theme.scent}`;
        let stars=""; for(let i=0;i<5;i++) stars+=(totalReceipts%5>i)?"‚ô• ":"‚ô° ";
        document.getElementById('stampsDisplay').innerText = stars;

        const bottomDiv = document.getElementById('bottomExtras');
        if (Math.random() < 0.3) {
           const coup = coupons[Math.floor(Math.random() * coupons.length)];
           bottomDiv.innerHTML = `<div class="coupon">‚úÇ ${coup} ‚úÇ</div>`;
        } else {
           const fort = fortunes[Math.floor(Math.random() * fortunes.length)];
           bottomDiv.innerHTML = `<div class="forecast">${fort}</div><div class="barcode">|| | ||| || |||</div>`;
        }
      }
      updateDisplay();
    }

    function claimTask(el) {
      if (el.classList.contains('checked')) return;
      el.classList.add('checked');
      el.innerHTML = "‚ú® CLAIMED (+2000)";
      lifetimeAura += 2000; localStorage.setItem('loyaltyAura', lifetimeAura); updateDisplay();
    }

    // INIT
    const grid = document.getElementById('signGrid');
    Object.keys(moods).forEach(key => {
      const btn = document.createElement('button');
      btn.className = 'sign-btn';
      btn.innerText = key;
      btn.onclick = () => generate(key);
      grid.appendChild(btn);
    });
    updateDisplay();

    if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
  </script>
</body>
</html>
