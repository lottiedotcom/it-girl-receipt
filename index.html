<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Cosmic Receipt</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="apple-mobile-web-app-status-bar-style" content="white">
  <meta name="theme-color" content="#ffffff">

  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600;700&family=Courier+Prime&display=swap" rel="stylesheet">

  <style>
    :root {
      /* Default to white/clean, updated by JS */
      --bg: #f8f9fa;
      --accent: #546e7a;
      --text: #37474f;
      --btn-text: #fff;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: "Quicksand", sans-serif;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.5s ease;
      padding: 20px;
      box-sizing: border-box;
    }

    /* --- INPUT SECTION --- */
    .controls {
      width: 100%;
      max-width: 360px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }

    .name-box {
      background: #fff;
      border: 2px solid var(--accent);
      padding: 15px;
      border-radius: 20px;
      font-family: "Quicksand", sans-serif;
      font-weight: 700;
      font-size: 1.1rem;
      text-align: center;
      color: var(--text);
      outline: none;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }

    /* GRID FOR SIGNS */
    .sign-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .sign-btn {
      background: #fff;
      border: 2px solid var(--accent);
      color: var(--accent);
      padding: 12px 5px;
      border-radius: 15px;
      font-weight: 700;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
    }

    .sign-btn:active {
      transform: scale(0.95);
      background: var(--accent);
      color: #fff;
    }

    /* --- RECEIPT --- */
    .receipt-container {
      perspective: 1000px;
      width: 100%;
      max-width: 340px;
      display: none; /* Hidden by default */
    }

    .receipt {
      background: #fff;
      padding: 25px 20px;
      font-family: "Courier Prime", monospace;
      color: #37474f;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      animation: printReceipt 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
      position: relative;
      
      /* Jagged edge */
      --mask: radial-gradient(10px at 50% 100%, #0000 98%, #000 100%) 50% calc(100% - 10px)/20px 100% repeat-x;
      -webkit-mask: var(--mask); 
      mask: var(--mask);
      padding-bottom: 50px;
    }

    @keyframes printReceipt {
      0% { height: 0; opacity: 0; transform: translateY(-50px); }
      100% { height: auto; opacity: 1; transform: translateY(0); }
    }

    .header { text-align: center; border-bottom: 2px dashed #b0bec5; padding-bottom: 15px; margin-bottom: 15px; }
    .header h2 { margin: 0; font-size: 1.6rem; color: var(--accent); letter-spacing: 1px; }
    .meta { font-size: 0.75rem; text-align: center; margin-bottom: 20px; line-height: 1.5; }
    
    .item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; }
    
    .total { margin-top: 20px; border-top: 2px dashed #b0bec5; padding-top: 15px; display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem; }
    
    .barcode { margin-top: 25px; text-align: center; font-size: 2rem; opacity: 0.4; letter-spacing: -4px; transform: scaleY(0.7); }
    
    /* TROPHY BAR */
    .trophy-bar {
      margin-top: 20px;
      background: rgba(255,255,255,0.3);
      padding: 10px 20px;
      border-radius: 99px;
      color: var(--text);
      font-weight: 700;
      font-size: 0.8rem;
      backdrop-filter: blur(5px);
      text-align: center;
    }
  </style>
</head>
<body>

  <div class="controls" id="controls">
    <input type="text" id="nameInput" class="name-box" placeholder="Your Name (or Secret Code)">
    
    <div class="sign-grid" id="signGrid">
      </div>
    
    <div class="trophy-bar" id="rankDisplay">
      RANK: STAR DUST (0)
    </div>
  </div>

  <div class="receipt-container" id="receiptContainer">
    <div class="receipt">
      <div class="header">
        <h2 id="storeName">COSMIC</h2>
        <div style="font-size: 0.8rem; margin-top:5px;">OFFICIAL RECEIPT</div>
      </div>

      <div class="meta" id="receiptMeta"></div>
      <div id="itemList"></div>

      <div class="total">
        <span>TOTAL:</span>
        <span id="totalText">100% CUTE</span>
      </div>

      <div style="text-align: center; font-size: 0.7rem; margin-top: 20px; opacity: 0.7;">
        THANK YOU FOR EXISTING
      </div>
      <div class="barcode">||| || ||||| || ||</div>
    </div>
    
    <div style="text-align:center; color: var(--text); font-size:0.8rem; margin-top:20px; opacity:0.6; cursor: pointer;">
      ( tap anywhere to reset )
    </div>
  </div>

  <script>
    // --- 1. THE 12 ZODIAC THEMES ---
    const zodiacs = {
      aries: { color: "#ff5252", bg: "#ffebee", items: ["Impulse Buy", "Being Loud", "Main Character Energy", "Starting a Fight"] },
      taurus: { color: "#4caf50", bg: "#e8f5e9", items: ["Expensive Snack", "Nap Time", "Cozy Blanket", "Stubbornness"] },
      gemini: { color: "#ffeb3b", bg: "#fffde7", items: ["Chaos", "Yap Session", "New Personality", "Gossip"] },
      cancer: { color: "#2196f3", bg: "#e3f2fd", items: ["Crying", "Plushie Collection", "Holding Grudges", "Comfort Food"] },
      leo: { color: "#ff9800", bg: "#fff3e0", items: ["Selfie", "God Complex", "Golden Jewelry", "Drama"] },
      virgo: { color: "#795548", bg: "#efebe9", items: ["Organizing", "Judgement", "To-Do List", "Clean Sheets"] },
      libra: { color: "#e91e63", bg: "#fce4ec", items: ["Flirting", "Indecision", "Pink Drink", "Aesthetic Post"] },
      scorpio: { color: "#212121", bg: "#eceff1", items: ["Revenge", "Stalking", "Black Hoodie", "Secrets"] },
      sagittarius: { color: "#673ab7", bg: "#ede7f6", items: ["Plane Ticket", "Philosophy", "Loud Laugh", "Ghosting"] },
      capricorn: { color: "#3e2723", bg: "#d7ccc8", items: ["Money", "Work Email", "Iced Coffee", "Ambition"] },
      aquarius: { color: "#00bcd4", bg: "#e0f7fa", items: ["Aliens", "God Complex", "Weird Hobby", "Rebellion"] },
      pisces: { color: "#9c27b0", bg: "#f3e5f5", items: ["Delusion", "Daydreaming", "Poetry", "Intuition"] }
    };

    // --- 2. THE 10 SECRET CODES ---
    const secrets = {
      "ghost": { color: "#b0bec5", bg: "#cfd8dc", store: "HAUNTED", item: "Ectoplasm" },
      "love": { color: "#f50057", bg: "#f8bbd0", store: "LOVER", item: "Heartbreak" },
      "rich": { color: "#00c853", bg: "#b9f6ca", store: "BANK", item: "Gold Bar" },
      "alien": { color: "#64dd17", bg: "#000000", store: "UFO", item: "Space Dust" }, // Black BG!
      "void": { color: "#607d8b", bg: "#263238", store: "ABYSS", item: "Nothingness" },
      "kitty": { color: "#ff80ab", bg: "#fff0f5", store: "MEOW", item: "Cat Nip" },
      "glitch": { color: "#00e676", bg: "#000000", store: "ERR_404", item: "Bug.exe" },
      "ocean": { color: "#0288d1", bg: "#e1f5fe", store: "ATLANTIS", item: "Salt Water" },
      "angel": { color: "#ffd54f", bg: "#fff8e1", store: "HEAVEN", item: "Halo" },
      "brat": { color: "#000000", bg: "#76ff03", store: "BRAT", item: "Vibes" }
    };

    const commonItems = [
      {name: "Iced Coffee", price: "$7.00"}, {name: "Sweet Treat", price: "$5.00"},
      {name: "Lip Gloss", price: "$12.00"}, {name: "Spotify Premium", price: "$11.00"},
      {name: "Girl Dinner", price: "$8.00"}, {name: "Mental Stability", price: "Sold Out"},
      {name: "Screen Time", price: "4hrs"}, {name: "Little Walk", price: "Free"}
    ];

    // --- 3. TROPHY LOGIC ---
    let xp = parseInt(localStorage.getItem('cosmicXP') || 0);

    function updateRank() {
      let rank = "Star Dust";
      if (xp > 5) rank = "Moon Child";
      if (xp > 10) rank = "Sun Chaser";
      if (xp > 20) rank = "Galaxy Brain";
      if (xp > 50) rank = "Cosmic Queen";
      if (xp > 100) rank = "Goddess";
      
      document.getElementById('rankDisplay').innerText = `RANK: ${rank.toUpperCase()} (${xp})`;
    }

    // --- 4. INIT PAGE ---
    // Generate Buttons
    const grid = document.getElementById('signGrid');
    Object.keys(zodiacs).forEach(sign => {
      const btn = document.createElement('button');
      btn.className = 'sign-btn';
      btn.innerText = sign;
      btn.onclick = () => generate(sign);
      grid.appendChild(btn);
    });
    updateRank();

    // --- 5. GENERATE FUNCTION ---
    function generate(signKey) {
      const nameRaw = document.getElementById('nameInput').value.trim().toLowerCase();
      const nameDisplay = document.getElementById('nameInput').value || "Guest";
      
      let theme = zodiacs[signKey];
      let storeName = "COSMIC";
      let bonusItem = null;
      let isSecret = false;

      // Check Secret Code
      if (secrets[nameRaw]) {
        const s = secrets[nameRaw];
        theme = { color: s.color, bg: s.bg };
        storeName = s.store;
        bonusItem = { name: s.item, price: " priceless" };
        isSecret = true;
      }

      // Apply Visuals
      document.documentElement.style.setProperty('--bg', theme.bg);
      document.documentElement.style.setProperty('--accent', theme.color);
      document.documentElement.style.setProperty('--text', theme.color); // Text matches accent
      
      // Update Content
      document.getElementById('storeName').innerText = storeName;
      document.getElementById('receiptMeta').innerHTML = `
        CUSTOMER: ${nameDisplay.toUpperCase()}<br>
        SIGN: ${signKey.toUpperCase()}<br>
        DATE: ${new Date().toLocaleDateString()}
      `;

      // Build Items
      let pool = [...commonItems];
      // Add zodiac specific items
      zodiacs[signKey].items.forEach(i => pool.push({name: i, price: "Special"}));
      
      const count = Math.floor(Math.random() * 3) + 3;
      const shuffled = pool.sort(() => 0.5 - Math.random());
      const selected = shuffled.slice(0, count);
      
      // Add secret item if applicable
      if (bonusItem) selected.unshift(bonusItem);

      let html = '';
      selected.forEach(i => {
        html += `<div class="item"><span>${i.name}</span><span>${i.price}</span></div>`;
      });
      document.getElementById('itemList').innerHTML = html;

      // Show Receipt
      document.getElementById('controls').style.display = 'none';
      document.getElementById('receiptContainer').style.display = 'block';

      // Save XP
      xp++;
      localStorage.setItem('cosmicXP', xp);
      updateRank();
    }

    // Reset Click
    document.addEventListener('click', (e) => {
      // Only reset if receipt is showing and we clicked the receipt container
      const container = document.getElementById('receiptContainer');
      if (container.style.display === 'block' && (e.target.closest('.receipt-container') || e.target.closest('.receipt'))) {
        document.getElementById('controls').style.display = 'flex';
        container.style.display = 'none';
        document.getElementById('nameInput').value = ""; // Clear name for next code
      }
    });

    if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
  </script>
</body>
</html>
